<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Transformation Functions for Functional Forms • JMbayes2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Transformation Functions for Functional Forms">
<meta name="robots" content="noindex">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-YDBZ5DBBSP"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-YDBZ5DBBSP');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">JMbayes2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5-9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/JMbayes2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Baseline_Hazard.html">Baseline Hazard Function</a></li>
    <li><a class="dropdown-item" href="../articles/Causal_Effects.html">Causal Effects</a></li>
    <li><a class="dropdown-item" href="../articles/Competing_Risks.html">Competing Risks</a></li>
    <li><a class="dropdown-item" href="../articles/Dynamic_Predictions.html">Dynamic Predictions</a></li>
    <li><a class="dropdown-item" href="../articles/Multi_State_Processes.html">Multi-State Processes</a></li>
    <li><a class="dropdown-item" href="../articles/Non_Gaussian_Mixed_Models.html">Non-Gaussian Mixed Models</a></li>
    <li><a class="dropdown-item" href="../articles/Recurring_Events.html">Recurrent Events</a></li>
    <li><a class="dropdown-item" href="../articles/Super_Learning.html">Combined Dynamic Predictions via Super Learning</a></li>
    <li><a class="dropdown-item" href="../articles/Time_Varying_Effects.html">Time Varying Effects</a></li>
    <li><a class="dropdown-item" href="../articles/Transformation_Functions.html">Transformation Functions for Functional Forms</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/drizopoulos/JMbayes2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Transformation Functions for Functional Forms</h1>
                        <h4 data-toc-skip class="author">Dimitris
Rizopoulos</h4>
            
            <h4 data-toc-skip class="date">2025-07-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/drizopoulos/JMbayes2/blob/HEAD/vignettes/Transformation_Functions.Rmd" class="external-link"><code>vignettes/Transformation_Functions.Rmd</code></a></small>
      <div class="d-none name"><code>Transformation_Functions.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="functional-forms">Functional Forms<a class="anchor" aria-label="anchor" href="#functional-forms"></a>
</h2>
<div class="section level3">
<h3 id="simplified-syntax">Simplified syntax<a class="anchor" aria-label="anchor" href="#simplified-syntax"></a>
</h3>
<p>We have <a href="https://drizopoulos.github.io/JMbayes2/articles/JMbayes2.html#functional-forms-1">previously
seen</a> that function <code><a href="../reference/jm.html">jm()</a></code> via its
<code>functional_forms</code> argument allows the specification of
different functional forms to link the longitudinal and event time
outcomes. This argument accepts either a single formula or a list of
formulas per longitudinal outcome with the terms we wish to include.</p>
<p>We will illustrate some of these possibilities using the PBC dataset.
We start by fitting a Cox model for the composite event transplantation
or death, including sex as a baseline covariate:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbc2.id</span><span class="op">$</span><span class="va">status2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">pbc2.id</span><span class="op">$</span><span class="va">status</span> <span class="op">!=</span> <span class="st">'alive'</span><span class="op">)</span></span>
<span><span class="va">CoxFit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">years</span>, <span class="va">status2</span><span class="op">)</span> <span class="op">~</span> <span class="va">sex</span>, data <span class="op">=</span> <span class="va">pbc2.id</span><span class="op">)</span></span></code></pre></div>
<p>Our aim is to assess the strength of the association between the risk
of the composite event and whether the patients experienced hepatomegaly
during follow-up. We will describe the patient-specific profiles over
time for this biomarker using a mixed-effects logistic model, where we
include an intercept and the time effect in both fixed and random
effects. The syntax to fit this model with <code><a href="https://drizopoulos.github.io/GLMMadaptive/reference/mixed_model.html" class="external-link">mixed_model()</a></code>
is:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://drizopoulos.github.io/GLMMadaptive/reference/mixed_model.html" class="external-link">mixed_model</a></span><span class="op">(</span><span class="va">hepatomegaly</span> <span class="op">~</span> <span class="va">year</span>, data <span class="op">=</span> <span class="va">pbc2</span>, random <span class="op">=</span> <span class="op">~</span> <span class="va">year</span> <span class="op">|</span> <span class="va">id</span>, </span>
<span>                  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The default call to <code><a href="../reference/jm.html">jm()</a></code> adds the subject-specific
linear predictor of the mixed-effects logistic regression as a
time-varying covariate in the survival relative risk model:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jointFit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jm.html">jm</a></span><span class="op">(</span><span class="va">CoxFit</span>, <span class="va">fm</span>, time_var <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">jointFit1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; jm(Surv_object = CoxFit, Mixed_objects = fm, time_var = "year")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Data Descriptives:</span></span>
<span><span class="co">#&gt; Number of Groups: 312        Number of events: 169 (54.2%)</span></span>
<span><span class="co">#&gt; Number of Observations:</span></span>
<span><span class="co">#&gt;   hepatomegaly: 1884</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                  DIC     WAIC      LPML</span></span>
<span><span class="co">#&gt; marginal    3077.880 3066.424 -1533.651</span></span>
<span><span class="co">#&gt; conditional 4988.864 4850.268 -2651.221</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random-effects covariance matrix:</span></span>
<span><span class="co">#&gt;                      </span></span>
<span><span class="co">#&gt;        StdDev   Corr </span></span>
<span><span class="co">#&gt; (Intr) 3.2996 (Intr) </span></span>
<span><span class="co">#&gt; year   0.5368 -0.1730</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Survival Outcome:</span></span>
<span><span class="co">#&gt;                        Mean  StDev    2.5%  97.5%      P   Rhat</span></span>
<span><span class="co">#&gt; sexfemale           -0.4733 0.3019 -1.0613 0.1357 0.1191 1.0011</span></span>
<span><span class="co">#&gt; value(hepatomegaly)  0.3591 0.0531  0.2641 0.4690 0.0000 1.0712</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Longitudinal Outcome: hepatomegaly (family = binomial, link = logit)</span></span>
<span><span class="co">#&gt;               Mean  StDev    2.5%  97.5%      P   Rhat</span></span>
<span><span class="co">#&gt; (Intercept) 0.0527 0.2282 -0.3928 0.5037 0.8244 1.0037</span></span>
<span><span class="co">#&gt; year        0.2836 0.0646  0.1561 0.4083 0.0000 1.0248</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; MCMC summary:</span></span>
<span><span class="co">#&gt; chains: 3 </span></span>
<span><span class="co">#&gt; iterations per chain: 3500 </span></span>
<span><span class="co">#&gt; burn-in per chain: 500 </span></span>
<span><span class="co">#&gt; thinning: 1 </span></span>
<span><span class="co">#&gt; time: 16 sec</span></span></code></pre></div>
<p>In the output, this is named <code>value(hepatomegaly)</code> to
denote that the current value functional form is used. That is, we
assume that the risk at a specific time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
is associated with the value of the linear predictor of the longitudinal
outcome at the same time point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.
In this case, the subject-specific linear predictor denotes the log odds
of experiencing hepatomegaly at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.</p>
</div>
<div class="section level3">
<h3 id="transformation-functions">Transformation functions<a class="anchor" aria-label="anchor" href="#transformation-functions"></a>
</h3>
<p>The fact that the default version of the current value functional
form is on the linear predictor scale of the mixed model may be
problematic to interpret when this linear predictor is connected with a
nonlinear link function to the mean of the longitudinal outcome. In
these situations, we may want to transform the subject-specific linear
predictor back to the scale of the outcome. To achieve this, we can use
a transformation function. Continuing on the previous example, we update
<code>jointFit1</code> by now linking the expit transformation of the
linear predictor (i.e.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">expit</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mo stretchy="false" form="prefix">{</mo><mn>1</mn><mo>+</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\mbox{expit}(x) = \exp(x) / \{1 + \exp(x)\}</annotation></semantics></math>)
with the risk of an event. This is done using the <code><a href="../reference/jm.html">vexpit()</a></code>
function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jointFit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">jointFit1</span>, functional_forms <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/jm.html">vexpit</a></span><span class="op">(</span><span class="fu"><a href="../reference/jm.html">value</a></span><span class="op">(</span><span class="va">hepatomegaly</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">jointFit2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; jm(Surv_object = CoxFit, Mixed_objects = fm, time_var = "year", </span></span>
<span><span class="co">#&gt;     functional_forms = ~vexpit(value(hepatomegaly)))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Data Descriptives:</span></span>
<span><span class="co">#&gt; Number of Groups: 312        Number of events: 169 (54.2%)</span></span>
<span><span class="co">#&gt; Number of Observations:</span></span>
<span><span class="co">#&gt;   hepatomegaly: 1884</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                  DIC     WAIC      LPML</span></span>
<span><span class="co">#&gt; marginal    3068.775 3059.436 -1530.111</span></span>
<span><span class="co">#&gt; conditional 5005.254 4904.042 -2701.585</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random-effects covariance matrix:</span></span>
<span><span class="co">#&gt;                      </span></span>
<span><span class="co">#&gt;        StdDev   Corr </span></span>
<span><span class="co">#&gt; (Intr) 3.3268 (Intr) </span></span>
<span><span class="co">#&gt; year   0.5302 -0.3244</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Survival Outcome:</span></span>
<span><span class="co">#&gt;                                Mean  StDev    2.5%  97.5%      P   Rhat</span></span>
<span><span class="co">#&gt; sexfemale                   -0.3479 0.2838 -0.8972 0.2201 0.2196 1.0019</span></span>
<span><span class="co">#&gt; vexpit(value(hepatomegaly))  3.2874 0.4691  2.3812 4.2400 0.0000 1.0166</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Longitudinal Outcome: hepatomegaly (family = binomial, link = logit)</span></span>
<span><span class="co">#&gt;               Mean  StDev    2.5%  97.5%      P   Rhat</span></span>
<span><span class="co">#&gt; (Intercept) 0.0657 0.2354 -0.3840 0.5423 0.7862 1.0015</span></span>
<span><span class="co">#&gt; year        0.2377 0.0619  0.1191 0.3605 0.0004 1.0017</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; MCMC summary:</span></span>
<span><span class="co">#&gt; chains: 3 </span></span>
<span><span class="co">#&gt; iterations per chain: 3500 </span></span>
<span><span class="co">#&gt; burn-in per chain: 500 </span></span>
<span><span class="co">#&gt; thinning: 1 </span></span>
<span><span class="co">#&gt; time: 17 sec</span></span></code></pre></div>
<p>Other available functions to use in the definition of the
<code>functional_forms</code> argument are <code><a href="../reference/jm.html">vexp()</a></code> to
calculate the exponent, <code><a href="../reference/jm.html">vlog()</a></code> to calculate the natural
logarithm, and <code><a href="../reference/jm.html">vsqrt()</a></code> to calculate the square root.</p>
<p>If we want to include the time-varying slope of the transformed
linear predictor, we also have the <code><a href="../reference/jm.html">Dexpit()</a></code> and
<code><a href="../reference/jm.html">Dexp()</a></code> functions available. As an example, we extend
<code>jointFit2</code> by including the derivative of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">expit</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mbox{expit}()</annotation></semantics></math>
transformation:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forms</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="fu"><a href="../reference/jm.html">vexpit</a></span><span class="op">(</span><span class="fu"><a href="../reference/jm.html">value</a></span><span class="op">(</span><span class="va">hepatomegaly</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/jm.html">Dexpit</a></span><span class="op">(</span><span class="fu"><a href="../reference/jm.html">slope</a></span><span class="op">(</span><span class="va">hepatomegaly</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">jointFit3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">jointFit1</span>, functional_forms <span class="op">=</span> <span class="va">forms</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">jointFit3</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; jm(Surv_object = CoxFit, Mixed_objects = fm, time_var = "year", </span></span>
<span><span class="co">#&gt;     functional_forms = forms)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Data Descriptives:</span></span>
<span><span class="co">#&gt; Number of Groups: 312        Number of events: 169 (54.2%)</span></span>
<span><span class="co">#&gt; Number of Observations:</span></span>
<span><span class="co">#&gt;   hepatomegaly: 1884</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                  DIC     WAIC      LPML</span></span>
<span><span class="co">#&gt; marginal    3067.439 3058.267 -1529.488</span></span>
<span><span class="co">#&gt; conditional 4990.422 4886.822 -2701.964</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random-effects covariance matrix:</span></span>
<span><span class="co">#&gt;                      </span></span>
<span><span class="co">#&gt;        StdDev   Corr </span></span>
<span><span class="co">#&gt; (Intr) 3.4301 (Intr) </span></span>
<span><span class="co">#&gt; year   0.5544 -0.4777</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Survival Outcome:</span></span>
<span><span class="co">#&gt;                                                    Mean  StDev    2.5%   97.5%</span></span>
<span><span class="co">#&gt; sexfemale                                       -0.3234 0.2953 -0.8756  0.2695</span></span>
<span><span class="co">#&gt; vexpit(value(hepatomegaly))                      3.2922 0.5259  2.3173  4.3695</span></span>
<span><span class="co">#&gt; Dexpit(value(hepatomegaly)):slope(hepatomegaly) -0.9686 0.4667 -2.0680 -0.2517</span></span>
<span><span class="co">#&gt;                                                      P   Rhat</span></span>
<span><span class="co">#&gt; sexfemale                                       0.2764 1.0079</span></span>
<span><span class="co">#&gt; vexpit(value(hepatomegaly))                     0.0000 1.0142</span></span>
<span><span class="co">#&gt; Dexpit(value(hepatomegaly)):slope(hepatomegaly) 0.0071 1.3755</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Longitudinal Outcome: hepatomegaly (family = binomial, link = logit)</span></span>
<span><span class="co">#&gt;               Mean  StDev    2.5%  97.5%      P   Rhat</span></span>
<span><span class="co">#&gt; (Intercept) 0.1410 0.2439 -0.3245 0.6345 0.5656 1.0179</span></span>
<span><span class="co">#&gt; year        0.1603 0.0688  0.0262 0.2970 0.0156 1.1988</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; MCMC summary:</span></span>
<span><span class="co">#&gt; chains: 3 </span></span>
<span><span class="co">#&gt; iterations per chain: 3500 </span></span>
<span><span class="co">#&gt; burn-in per chain: 500 </span></span>
<span><span class="co">#&gt; thinning: 1 </span></span>
<span><span class="co">#&gt; time: 20 sec</span></span></code></pre></div>
<p>The call to <code>Dexpit(slope(hepatomegaly))</code> is internally
transformed to
<code>Dexpit(value(hepatomegaly)):slope(hepatomegaly)</code>, which
calculates the derivative of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">expit</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mbox{expit}()</annotation></semantics></math>
evaluated at the linear predictor times the derivative of the linear
predictor. This is because <span class="math display">$$\frac{d}{dt}
\mbox{expit}\{\eta(t)\} = \mbox{expit}\{\eta(t)\} \, \Bigl [ 1 -
\mbox{expit}\{\eta(t)\} \Bigr ] \times \frac{d}{dt}\eta(t)$$</span></p>
</div>
<div class="section level3">
<h3 id="the-slope-functional-form">The Slope functional form<a class="anchor" aria-label="anchor" href="#the-slope-functional-form"></a>
</h3>
<p>As we have seen in previous examples, the <code><a href="../reference/jm.html">slope()</a></code>
function is used to specify the slope functional form
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>η</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mi>d</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">d \eta(t)/dt</annotation></semantics></math>.
According to the <a href="https://en.wikipedia.org/wiki/Derivative#Rigorous_definition" class="external-link">definition
of the derivative</a>, this corresponds to the change in the
longitudinal profile
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><mi>η</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>+</mo><mi>ε</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mi>η</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo><mi>/</mi><mi>ε</mi></mrow><annotation encoding="application/x-tex">\{\eta(t + \varepsilon) - \eta(t)\}/ \varepsilon</annotation></semantics></math>
as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ε</mi><annotation encoding="application/x-tex">\varepsilon</annotation></semantics></math>
approaches zero. However, the interpretation of this term may be
challenging in some settings. A possible alternative would be to
increase the value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ε</mi><annotation encoding="application/x-tex">\varepsilon</annotation></semantics></math>,
e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ε</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\varepsilon = 1</annotation></semantics></math>.
For example, if the time scale is years, this would quantify the change
of the longitudinal profile in the last year before
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.</p>
<p>To fit a joint model with such a term, we can use the
<code>eps</code> and <code>direction</code> arguments of the
<code><a href="../reference/jm.html">slope()</a></code> function. We illustrate this in the following
example, in which we use the serum bilirubin</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/lme.html" class="external-link">lme</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">serBilir</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></span><span class="op">(</span><span class="va">year</span>, <span class="fl">2</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">pbc2</span>, random <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></span><span class="op">(</span><span class="va">year</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">|</span> <span class="va">id</span>,</span>
<span>          control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/lmeControl.html" class="external-link">lmeControl</a></span><span class="op">(</span>opt <span class="op">=</span> <span class="st">"optim"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We first fit the joint model with time-varying slope term:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jFit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jm.html">jm</a></span><span class="op">(</span><span class="va">CoxFit</span>, <span class="va">gm</span>, time_var <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>            functional_forms <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/jm.html">value</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">serBilir</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/jm.html">slope</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">serBilir</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To specify that we want to include the change in the log serum
bilirubin levels during the last year before
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
we specify <code>eps = 1</code> and <code>direction = "back"</code> in
the call to <code><a href="../reference/jm.html">slope()</a></code>. This calculates the term
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><mi>η</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mi>η</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><mi>ε</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo><mi>/</mi><mi>ε</mi></mrow><annotation encoding="application/x-tex">\{\eta(t) - \eta(t - \varepsilon)\} / \varepsilon</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ε</mi><annotation encoding="application/x-tex">\varepsilon</annotation></semantics></math>
set equal to <code>eps = 1</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jFit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jm.html">jm</a></span><span class="op">(</span><span class="va">CoxFit</span>, <span class="va">gm</span>, time_var <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>            functional_forms <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/jm.html">value</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">serBilir</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>              <span class="fu"><a href="../reference/jm.html">slope</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">serBilir</span><span class="op">)</span>, eps <span class="op">=</span> <span class="fl">1</span>, direction <span class="op">=</span> <span class="st">"back"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We compare the two fits</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">jFit1</span><span class="op">)</span><span class="op">$</span><span class="va">Survival</span></span>
<span><span class="co">#&gt;                            Mean     StDev       2.5%    97.5%         P</span></span>
<span><span class="co">#&gt; sexfemale            -0.1683743 0.2795170 -0.6744899 0.405122 0.5535556</span></span>
<span><span class="co">#&gt; value(log(serBilir))  1.2223588 0.1054294  1.0243374 1.429878 0.0000000</span></span>
<span><span class="co">#&gt; slope(log(serBilir))  2.9624164 0.6749065  1.7579233 4.393638 0.0000000</span></span>
<span><span class="co">#&gt;                          Rhat</span></span>
<span><span class="co">#&gt; sexfemale            1.008869</span></span>
<span><span class="co">#&gt; value(log(serBilir)) 1.010025</span></span>
<span><span class="co">#&gt; slope(log(serBilir)) 1.043587</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">jFit2</span><span class="op">)</span><span class="op">$</span><span class="va">Survival</span></span>
<span><span class="co">#&gt;                                                         Mean     StDev</span></span>
<span><span class="co">#&gt; sexfemale                                         -0.1647358 0.2732504</span></span>
<span><span class="co">#&gt; value(log(serBilir))                               1.2098188 0.1075358</span></span>
<span><span class="co">#&gt; slope(log(serBilir), eps = 1, direction = "back")  2.8433863 0.6355504</span></span>
<span><span class="co">#&gt;                                                         2.5%     97.5%</span></span>
<span><span class="co">#&gt; sexfemale                                         -0.6761072 0.3902834</span></span>
<span><span class="co">#&gt; value(log(serBilir))                               0.9971623 1.4245781</span></span>
<span><span class="co">#&gt; slope(log(serBilir), eps = 1, direction = "back")  1.7099160 4.1559186</span></span>
<span><span class="co">#&gt;                                                           P     Rhat</span></span>
<span><span class="co">#&gt; sexfemale                                         0.5344444 1.007342</span></span>
<span><span class="co">#&gt; value(log(serBilir))                              0.0000000 1.013989</span></span>
<span><span class="co">#&gt; slope(log(serBilir), eps = 1, direction = "back") 0.0000000 1.044426</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.drizopoulos.com/" class="external-link">Dimitris Rizopoulos</a>, <a href="https://pafonso.com/" class="external-link">Pedro Miranda Afonso</a>, <a href="https://gregpapageorgiou.com/" class="external-link">Grigorios Papageorgiou</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
