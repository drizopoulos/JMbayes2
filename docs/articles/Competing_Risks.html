<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Competing Risks • JMbayes2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Competing Risks">
<meta name="robots" content="noindex">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-YDBZ5DBBSP"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-YDBZ5DBBSP');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">JMbayes2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6-0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/JMbayes2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Baseline_Hazard.html">Baseline Hazard Function</a></li>
    <li><a class="dropdown-item" href="../articles/Causal_Effects.html">Causal Effects</a></li>
    <li><a class="dropdown-item" href="../articles/Competing_Risks.html">Competing Risks</a></li>
    <li><a class="dropdown-item" href="../articles/Consensus.html">Fitting Joint Models to Big Datasets with Consensus Monte Carlo</a></li>
    <li><a class="dropdown-item" href="../articles/Dynamic_Predictions.html">Dynamic Predictions</a></li>
    <li><a class="dropdown-item" href="../articles/Multi_State_Processes.html">Multi-State Processes</a></li>
    <li><a class="dropdown-item" href="../articles/Non_Gaussian_Mixed_Models.html">Non-Gaussian Mixed Models</a></li>
    <li><a class="dropdown-item" href="../articles/Posterior_Predictive_Checks.html">Posterior Predictive Checks</a></li>
    <li><a class="dropdown-item" href="../articles/Recurring_Events.html">Recurrent Events</a></li>
    <li><a class="dropdown-item" href="../articles/Super_Learning.html">Combined Dynamic Predictions via Super Learning</a></li>
    <li><a class="dropdown-item" href="../articles/Time_Varying_Effects.html">Time Varying Effects</a></li>
    <li><a class="dropdown-item" href="../articles/Transformation_Functions.html">Transformation Functions for Functional Forms</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/drizopoulos/JMbayes2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Competing Risks</h1>
                        <h4 data-toc-skip class="author">Dimitris
Rizopoulos</h4>
            
            <h4 data-toc-skip class="date">2026-01-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/drizopoulos/JMbayes2/blob/HEAD/vignettes/Competing_Risks.Rmd" class="external-link"><code>vignettes/Competing_Risks.Rmd</code></a></small>
      <div class="d-none name"><code>Competing_Risks.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="joint-models-with-competing-risks">Joint Models with Competing Risks<a class="anchor" aria-label="anchor" href="#joint-models-with-competing-risks"></a>
</h2>
<div class="section level3">
<h3 id="prepare-data">Prepare data<a class="anchor" aria-label="anchor" href="#prepare-data"></a>
</h3>
<p>The first step in fitting a joint model for competing events in
<strong>JMbayes2</strong> is to prepare the data for the event process.
If there are <span class="math inline">K</span> competing events, each
subject must have <span class="math inline">K</span> rows, one for each
possible cause. The observed event time <span class="math inline">T_i</span> of each subject is repeated <span class="math inline">K</span> times, and there are two indicator
variables, namely one identifying the cause and one indicating whether
the corresponding event type is the one that occurred. Standard survival
datasets that include a single row per patient can be easily transformed
to the competing risks long format using the function
<code><a href="../reference/cr_setup.html">crisk_setup()</a></code>. This function accepts as main arguments the
survival data in the standard format with a single row per patient, the
name of the status variable, and the level in this status variable that
corresponds to censoring. We illustrate the use of this function in the
PBC data, where we treat as competing risks transplantation and
death:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbc2.id</span><span class="op">[</span><span class="va">pbc2.id</span><span class="op">$</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"years"</span>, <span class="st">"status"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;   id     years       status</span></span>
<span><span class="co">#&gt; 1  1  1.095170         dead</span></span>
<span><span class="co">#&gt; 2  2 14.152338        alive</span></span>
<span><span class="co">#&gt; 5  5  4.120578 transplanted</span></span>
<span></span>
<span><span class="va">pbc2.idCR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cr_setup.html">crisk_setup</a></span><span class="op">(</span><span class="va">pbc2.id</span>, statusVar <span class="op">=</span> <span class="st">"status"</span>, censLevel <span class="op">=</span> <span class="st">"alive"</span>, </span>
<span>                         nameStrata <span class="op">=</span> <span class="st">"CR"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pbc2.idCR</span><span class="op">[</span><span class="va">pbc2.idCR</span><span class="op">$</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span>, </span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"years"</span>, <span class="st">"status"</span>, <span class="st">"status2"</span>, <span class="st">"CR"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;     id     years       status status2           CR</span></span>
<span><span class="co">#&gt; 1    1  1.095170         dead       1         dead</span></span>
<span><span class="co">#&gt; 1.1  1  1.095170         dead       0 transplanted</span></span>
<span><span class="co">#&gt; 2    2 14.152338        alive       0         dead</span></span>
<span><span class="co">#&gt; 2.1  2 14.152338        alive       0 transplanted</span></span>
<span><span class="co">#&gt; 5    5  4.120578 transplanted       0         dead</span></span>
<span><span class="co">#&gt; 5.1  5  4.120578 transplanted       1 transplanted</span></span></code></pre></div>
<p>Note that each patient is now represented by two rows (we have two
possible causes of discontinuation from the study, death, and
transplantation), the event time variable <code>years</code> is
identical in both rows of each patient, variable <code>CR</code> denotes
the cause for the specific line of the long dataset, and variable
<code>status2</code> equals 1 if the corresponding event occurred.</p>
</div>
<div class="section level3">
<h3 id="fit-models">Fit models<a class="anchor" aria-label="anchor" href="#fit-models"></a>
</h3>
<p>For the event process, we specify cause-specific relative risk
models. Using dataset <code>pbc2.idCR</code>, we fit the corresponding
cause-specific Cox regressions by including the interaction terms of age
and treatment with variable <code>CR</code>, which is treated as a
stratification variable using the <code>strata()</code> function:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CoxFit_CR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sliced_model_generics.html">coxph</a></span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">years</span>, <span class="va">status2</span><span class="op">)</span> <span class="op">~</span> <span class="op">(</span><span class="va">age</span> <span class="op">+</span> <span class="va">drug</span><span class="op">)</span><span class="op">:</span><span class="fu">strata</span><span class="op">(</span><span class="va">CR</span><span class="op">)</span>,</span>
<span>                     data <span class="op">=</span> <span class="va">pbc2.idCR</span><span class="op">)</span></span></code></pre></div>
<p>We include two longitudinal outcomes for the longitudinal process:
serum bilirubin and the prothrombin time. For the former, we use
quadratic orthogonal polynomials in the fixed- and random-effects parts,
and for the latter, linear evolutions:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sliced_model_generics.html">lme</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">serBilir</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">year</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="va">drug</span>, data <span class="op">=</span> <span class="va">pbc2</span>, </span>
<span>           random <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">year</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span></span>
<span><span class="va">fm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sliced_model_generics.html">lme</a></span><span class="op">(</span><span class="va">prothrombin</span> <span class="op">~</span> <span class="va">year</span> <span class="op">*</span> <span class="va">drug</span>, data <span class="op">=</span> <span class="va">pbc2</span>, random <span class="op">=</span> <span class="op">~</span> <span class="va">year</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span></span></code></pre></div>
<p>To specify that each longitudinal outcome has a separate association
coefficient per competing risk, we define the corresponding functional
forms:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CR_forms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"log(serBilir)"</span> <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/jm.html">value</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">serBilir</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="va">CR</span>,</span>
<span>    <span class="st">"prothrombin"</span> <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/jm.html">value</a></span><span class="op">(</span><span class="va">prothrombin</span><span class="op">)</span><span class="op">:</span><span class="va">CR</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Finally, the competing risks joint model is fitted with the following
call to <code><a href="../reference/jm.html">jm()</a></code> (due to the complexity of the model, we have
increased the number of MCMC iterations and the burn-in period per
chain). Also, because relatively few patients received a
transplantation, we specify a Weibull baseline hazard function for this
competing event, and the default penalized B-spline approximation for
death:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jFit_CR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jm.html">jm</a></span><span class="op">(</span><span class="va">CoxFit_CR</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fm1</span>, <span class="va">fm2</span><span class="op">)</span>, time_var <span class="op">=</span> <span class="st">"year"</span>, </span>
<span>              functional_forms <span class="op">=</span> <span class="va">CR_forms</span>, </span>
<span>              base_hazard <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"weibull"</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>              n_iter <span class="op">=</span> <span class="fl">25000L</span>, n_burnin <span class="op">=</span> <span class="fl">5000L</span>, n_thin <span class="op">=</span> <span class="fl">5L</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">jFit_CR</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; JMbayes2::jm(Surv_object = CoxFit_CR, Mixed_objects = list(fm1, </span></span>
<span><span class="co">#&gt;     fm2), time_var = "year", functional_forms = CR_forms, base_hazard = c("weibull", </span></span>
<span><span class="co">#&gt;     NA), n_iter = 25000L, n_burnin = 5000L, n_thin = 5L)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Data Descriptives:</span></span>
<span><span class="co">#&gt; Number of Groups: 312        Number of events: 169 (27.1%)</span></span>
<span><span class="co">#&gt; Number of Observations:</span></span>
<span><span class="co">#&gt;   log(serBilir): 1945</span></span>
<span><span class="co">#&gt;   prothrombin: 1945</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                  DIC     WAIC      LPML</span></span>
<span><span class="co">#&gt; marginal    10826.05 11552.64 -6915.799</span></span>
<span><span class="co">#&gt; conditional 15753.47 15441.05 -8229.663</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random-effects covariance matrix:</span></span>
<span><span class="co">#&gt;                                              </span></span>
<span><span class="co">#&gt;        StdDev    Corr                        </span></span>
<span><span class="co">#&gt; (Intr) 1.3413  (Intr)  p(,2)1  p(,2)2  (Intr)</span></span>
<span><span class="co">#&gt; p(,2)1 23.0242 0.7078                        </span></span>
<span><span class="co">#&gt; p(,2)2 12.3462 -0.2624 -0.1501               </span></span>
<span><span class="co">#&gt; (Intr) 0.7850  0.6336  0.4416  -0.3343       </span></span>
<span><span class="co">#&gt; year   0.3251  0.4292  0.3369  -0.0495 0.0398</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Survival Outcome:</span></span>
<span><span class="co">#&gt;                                         Mean  StDev    2.5%   97.5%      P</span></span>
<span><span class="co">#&gt; age:strata(CR)transplanted           -0.0786 0.0253 -0.1301 -0.0315 0.0007</span></span>
<span><span class="co">#&gt; age:strata(CR)dead                    0.0656 0.0099  0.0468  0.0857 0.0000</span></span>
<span><span class="co">#&gt; drugD-penicil:strata(CR)transplanted -0.3134 0.3902 -1.1019  0.4500 0.4107</span></span>
<span><span class="co">#&gt; drugD-penicil:strata(CR)dead          0.0073 0.1883 -0.3626  0.3763 0.9802</span></span>
<span><span class="co">#&gt; value(log(serBilir)):CRtransplanted   1.0878 0.2153  0.6830  1.5252 0.0000</span></span>
<span><span class="co">#&gt; value(log(serBilir)):CRdead           1.4680 0.1194  1.2463  1.7156 0.0000</span></span>
<span><span class="co">#&gt; value(prothrombin):CRtransplanted    -0.1225 0.1649 -0.4453  0.2001 0.4632</span></span>
<span><span class="co">#&gt; value(prothrombin):CRdead             0.1527 0.0463  0.0562  0.2392 0.0050</span></span>
<span><span class="co">#&gt;                                        Rhat</span></span>
<span><span class="co">#&gt; age:strata(CR)transplanted           1.0301</span></span>
<span><span class="co">#&gt; age:strata(CR)dead                   1.0068</span></span>
<span><span class="co">#&gt; drugD-penicil:strata(CR)transplanted 1.0102</span></span>
<span><span class="co">#&gt; drugD-penicil:strata(CR)dead         1.0032</span></span>
<span><span class="co">#&gt; value(log(serBilir)):CRtransplanted  1.0054</span></span>
<span><span class="co">#&gt; value(log(serBilir)):CRdead          1.0186</span></span>
<span><span class="co">#&gt; value(prothrombin):CRtransplanted    1.0732</span></span>
<span><span class="co">#&gt; value(prothrombin):CRdead            1.0176</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Longitudinal Outcome: log(serBilir) (family = gaussian, link = identity)</span></span>
<span><span class="co">#&gt;                   Mean  StDev     2.5%   97.5%      P   Rhat</span></span>
<span><span class="co">#&gt; (Intercept)     1.2023 0.1139   0.9797  1.4258 0.0000 1.0035</span></span>
<span><span class="co">#&gt; poly(year, 2)1 28.0606 3.0382  22.3560 34.2529 0.0000 1.0125</span></span>
<span><span class="co">#&gt; poly(year, 2)2  1.2012 1.7767  -2.2584  4.7177 0.4997 1.0075</span></span>
<span><span class="co">#&gt; drugD-penicil  -0.1957 0.1576  -0.5046  0.1079 0.2195 1.0002</span></span>
<span><span class="co">#&gt; p(,2)1         -3.4221 3.6144 -10.6940  3.5380 0.3425 1.0004</span></span>
<span><span class="co">#&gt; p(,2)2         -1.1121 2.1833  -5.4202  3.1215 0.6052 1.0012</span></span>
<span><span class="co">#&gt; sigma           0.3025 0.0062   0.2906  0.3151 0.0000 0.9999</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Longitudinal Outcome: prothrombin (family = gaussian, link = identity)</span></span>
<span><span class="co">#&gt;                       Mean  StDev    2.5%   97.5%      P   Rhat</span></span>
<span><span class="co">#&gt; (Intercept)        10.6399 0.0838 10.4751 10.8046 0.0000 1.0016</span></span>
<span><span class="co">#&gt; year                0.2895 0.0394  0.2132  0.3689 0.0000 1.0098</span></span>
<span><span class="co">#&gt; drugD-penicil      -0.1000 0.1174 -0.3279  0.1304 0.3962 1.0003</span></span>
<span><span class="co">#&gt; year:drugD-penicil -0.0205 0.0518 -0.1236  0.0799 0.6977 1.0003</span></span>
<span><span class="co">#&gt; sigma               1.0550 0.0204  1.0157  1.0957 0.0000 1.0014</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; MCMC summary:</span></span>
<span><span class="co">#&gt; chains: 3 </span></span>
<span><span class="co">#&gt; iterations per chain: 25000 </span></span>
<span><span class="co">#&gt; burn-in per chain: 5000 </span></span>
<span><span class="co">#&gt; thinning: 5 </span></span>
<span><span class="co">#&gt; time: 5.2 min</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="dynamic-predictions">Dynamic predictions<a class="anchor" aria-label="anchor" href="#dynamic-predictions"></a>
</h3>
<p>Based on the fitted competing risks joint model, we will illustrate
how (dynamic) predictions can be calculated for the cause-specific
cumulative risk probabilities. As an example, we will show these
calculations for Patient 81 from the PBC dataset. First, we extract the
data on this subject.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ND_long</span> <span class="op">&lt;-</span> <span class="va">pbc2</span><span class="op">[</span><span class="va">pbc2</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="fl">81</span>, <span class="op">]</span></span>
<span><span class="va">ND_event</span> <span class="op">&lt;-</span> <span class="va">pbc2.idCR</span><span class="op">[</span><span class="va">pbc2.idCR</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="fl">81</span>, <span class="op">]</span></span>
<span><span class="va">ND_event</span><span class="op">$</span><span class="va">status2</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">ND</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>newdataL <span class="op">=</span> <span class="va">ND_long</span>, newdataE <span class="op">=</span> <span class="va">ND_event</span><span class="op">)</span></span></code></pre></div>
<p>The first line extracts the longitudinal measurements, and the second
line extracts the event times per cause (i.e., death and
transplantation). This patient died at 6.95 years, but to make the
calculation of cause-specific cumulative risk more relevant, we presume
that she did not have the event, and we set the event status variable
<code>status2</code> to zero. The last line combines the two datasets in
a list. <em>Note:</em> this last step is a prerequisite from the
<code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> method for competing risks joint model. That is,
the datasets provided in the arguments <code>newdata</code> and
<code>newdata2</code> need to be named lists with two components. The
first component needs to be named <code>newdataL</code> and contain the
dataset with the longitudinal measurements. The second component needs
to be named <code>newdataE</code> and contain the dataset with the event
information.</p>
<p>The predictions are calculated using the <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>
method. The first call to this function calculates the prediction for
the longitudinal outcomes at the times provided in the
<code>times</code> argument, and the second call calculates the
cause-specific cumulative risk probabilities. By setting the argument
<code>return_newdata</code> to <code>TRUE</code> in both calls, we can
use the corresponding <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method to depict the
predictions:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predLong</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">jFit_CR</span>, newdata <span class="op">=</span> <span class="va">ND</span>, return_newdata <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                    times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">6.5</span>, <span class="fl">15</span>, length <span class="op">=</span> <span class="fl">25</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">predEvent</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">jFit_CR</span>, newdata <span class="op">=</span> <span class="va">ND</span>, return_newdata <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     process <span class="op">=</span> <span class="st">"event"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">predLong</span>, <span class="va">predEvent</span>, outcomes <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, ylim_long_outcome_range <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>     col_line_event <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#03BF3D"</span>, <span class="st">"#FF0000"</span><span class="op">)</span>, </span>
<span>     fill_CI_event <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#03BF3D4D"</span>, <span class="st">"#FF00004D"</span><span class="op">)</span>, pos_ylab_long <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">11.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">8.1</span>, y <span class="op">=</span> <span class="fl">0.45</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">pbc2.idCR</span><span class="op">$</span><span class="va">CR</span><span class="op">)</span>, </span>
<span>       lty <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#03BF3D"</span>, <span class="st">"#FF0000"</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<p><img src="Competing_Risks_files/figure-html/CIFs-1.png" class="r-plt" alt="" width="816" style="display: block; margin: auto;"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.drizopoulos.com/" class="external-link">Dimitris Rizopoulos</a>, <a href="https://pafonso.com/" class="external-link">Pedro Miranda-Afonso</a>, <a href="https://gregpapageorgiou.com/" class="external-link">Grigorios Papageorgiou</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
