<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multi-State Processes • JMbayes2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="../favicon-48x48.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Multi-State Processes">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-YDBZ5DBBSP"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-YDBZ5DBBSP');
</script>
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">JMbayes2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5-4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/JMbayes2.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Causal_Effects.html">Causal Effects</a>
    </li>
    <li>
      <a href="../articles/Competing_Risks.html">Competing Risks</a>
    </li>
    <li>
      <a href="../articles/Dynamic_Predictions.html">Dynamic Predictions</a>
    </li>
    <li>
      <a href="../articles/Multi_State_Processes.html">Multi-State Processes</a>
    </li>
    <li>
      <a href="../articles/Non_Gaussian_Mixed_Models.html">Non-Gaussian Mixed Models</a>
    </li>
    <li>
      <a href="../articles/Recurring_Events.html">Recurrent Events</a>
    </li>
    <li>
      <a href="../articles/Super_Learning.html">Combined Dynamic Predictions via Super Learning</a>
    </li>
    <li>
      <a href="../articles/Time_Varying_Effects.html">Time Varying Effects</a>
    </li>
    <li>
      <a href="../articles/Transformation_Functions.html">Transformation Functions for Functional Forms</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/drizopoulos/JMbayes2/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>

    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Multi-State Processes</h1>
                        <h4 data-toc-skip class="author">Grigorios
Papageorgiou</h4>
            
            <h4 data-toc-skip class="date">2025-05-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/drizopoulos/JMbayes2/blob/HEAD/vignettes/Multi_State_Processes.Rmd" class="external-link"><code>vignettes/Multi_State_Processes.Rmd</code></a></small>
      <div class="hidden name"><code>Multi_State_Processes.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="multi-state-processes">Multi-state Processes<a class="anchor" aria-label="anchor" href="#multi-state-processes"></a>
</h2>
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>A subject may often transition between multiple states, and we are
interested in assessing the association of longitudinal marker(s) with
each of these transitions. In this vignette, we will illustrate how to
achieve this using <strong>JMbayes2</strong>.</p>
<p>We will consider a simple case with one longitudinal outcome and a
three-state (illness-death) model, but this application can be extended
for the cases of multiple longitudinal markers and more than three
states.</p>
</div>
<div class="section level3">
<h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>First, we will simulate data from a joint model with a single linear
mixed effects model and a multi-state process with three possible
states. The multi-state process can be visualized as:
<img src="Multi_State_Processes_files/figure-html/ms_figure-1.png" width="700"></p>
<p>where all subjects start from the state “Healthy” and then can
transition to either state “Illness” and then state “Death” or directly
to state “Death.” In this case, states “Healthy” and “Illness” are
<em>transient</em> states as the subject, when occupying these states,
can still transition to other states, whereas “Death” is an absorbing
state as when a subject reaches this state then no further transitions
can occur. This means that three transitions are possible:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>→</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">1 \rightarrow 2</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>→</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">1 \rightarrow 3</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>→</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">2 \rightarrow 3</annotation></semantics></math>
with transition intensities
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>12</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h_{12}\left(t\right)</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>13</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h_{13}\left(t\right)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>23</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h_{23}\left(t\right)</annotation></semantics></math>
respectively.</p>
<p>For our example, the default functional form is assumed, i.e., that
the linear predictor
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>η</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\eta(t)</annotation></semantics></math>
of the mixed model is associated with each transition intensity at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.
The following piece of code simulates the data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set seed for reproducibility</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1710</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Sample sizes and settings</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">1500</span></span>
<span><span class="va">n_per</span> <span class="op">&lt;-</span> <span class="fl">14</span></span>
<span></span>
<span><span class="co"># Baseline covariate (binary)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Longitudinal parameters</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="op">-</span><span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">sigma_e</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="va">N</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, Sigma <span class="op">=</span> <span class="va">D</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate longitudinal data</span></span>
<span><span class="va">df_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">obs_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_per</span> <span class="op">-</span> <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">18</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">XX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">obs_times</span><span class="op">)</span></span>
<span>    <span class="va">eta</span> <span class="op">&lt;-</span> <span class="va">XX</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta</span> <span class="op">+</span> <span class="va">XX</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">b</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span></span>
<span>    <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_per</span>, <span class="va">eta</span>, <span class="va">sigma_e</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">i</span>, time <span class="op">=</span> <span class="va">obs_times</span>, y <span class="op">=</span> <span class="va">y</span>, X <span class="op">=</span> <span class="va">X</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Weibull hazard parameters (shape, scale), association, covariate effects</span></span>
<span><span class="va">weib_shape</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.2</span>, <span class="fl">1.8</span>, <span class="fl">2.5</span><span class="op">)</span></span>
<span><span class="va">weib_scale</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.04</span>, <span class="fl">0.03</span>, <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">0.4</span>, <span class="fl">0.8</span><span class="op">)</span> <span class="co"># different for each transition</span></span>
<span><span class="va">gamma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.3</span>, <span class="fl">0.7</span><span class="op">)</span> <span class="co"># different for each transition</span></span>
<span><span class="va">Ctimes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">7</span>, <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Longitudinal trajectory function</span></span>
<span><span class="va">yfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">b_i</span>, <span class="va">t</span><span class="op">)</span> <span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">b_i</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="op">(</span><span class="va">beta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">b_i</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">t</span></span>
<span></span>
<span><span class="co"># Simulate event time via inverse transform</span></span>
<span><span class="va">sim_time</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">shape</span>, <span class="va">scale</span>, <span class="va">alpha</span>, <span class="va">gamma</span>, <span class="va">X</span>, <span class="va">b_i</span>, <span class="va">tmax</span> <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">U</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">cumhaz</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/stats/integrate.html" class="external-link">integrate</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">h0</span> <span class="op">&lt;-</span> <span class="va">shape</span> <span class="op">*</span> <span class="va">scale</span> <span class="op">*</span> <span class="op">(</span><span class="va">scale</span> <span class="op">*</span> <span class="va">s</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="va">shape</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span>            <span class="va">h0</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">alpha</span> <span class="op">*</span> <span class="fu">yfun</span><span class="op">(</span><span class="va">b_i</span>, <span class="va">s</span><span class="op">)</span> <span class="op">+</span> <span class="va">gamma</span> <span class="op">*</span> <span class="va">X</span><span class="op">)</span></span>
<span>        <span class="op">}</span>, <span class="fl">0</span>, <span class="va">t</span><span class="op">)</span><span class="op">$</span><span class="va">value</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="fu">cumhaz</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">U</span><span class="op">)</span></span>
<span>    <span class="va">out</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/uniroot.html" class="external-link">uniroot</a></span><span class="op">(</span><span class="va">f</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1e-5</span>, <span class="va">tmax</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">root</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">out</span>, <span class="st">"try-error"</span><span class="op">)</span><span class="op">)</span> <span class="cn">Inf</span> <span class="kw">else</span> <span class="va">out</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Simulate multi-state transitions</span></span>
<span><span class="va">df_surv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">b_i</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span>; <span class="va">X_i</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>; <span class="va">C</span> <span class="op">&lt;-</span> <span class="va">Ctimes</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="va">T01</span> <span class="op">&lt;-</span> <span class="fu">sim_time</span><span class="op">(</span><span class="va">weib_shape</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">weib_scale</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">alpha</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">gamma</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">X_i</span>, <span class="va">b_i</span><span class="op">)</span></span>
<span>    <span class="va">T02</span> <span class="op">&lt;-</span> <span class="fu">sim_time</span><span class="op">(</span><span class="va">weib_shape</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">weib_scale</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">alpha</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">gamma</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">X_i</span>, <span class="va">b_i</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">T01</span> <span class="op">&lt;</span> <span class="va">T02</span> <span class="op">&amp;&amp;</span> <span class="va">T01</span> <span class="op">&lt;</span> <span class="va">C</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">T12</span> <span class="op">&lt;-</span> <span class="fu">sim_time</span><span class="op">(</span><span class="va">weib_shape</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">weib_scale</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">alpha</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">gamma</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">X_i</span>, <span class="va">b_i</span><span class="op">)</span></span>
<span>        <span class="va">Tdeath</span> <span class="op">&lt;-</span> <span class="va">T01</span> <span class="op">+</span> <span class="va">T12</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">i</span>, </span>
<span>                   transition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>                   Tstart <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="va">T01</span><span class="op">)</span>, </span>
<span>                   Tstop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">T01</span>, <span class="va">T01</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">Tdeath</span>, <span class="va">C</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                   status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">T12</span> <span class="op">&lt;</span> <span class="op">(</span><span class="va">C</span> <span class="op">-</span> <span class="va">T01</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                   X <span class="op">=</span> <span class="va">X_i</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">T02</span> <span class="op">&lt;</span> <span class="va">C</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">i</span>, transition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, Tstart <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, Tstop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">T02</span>, <span class="va">T02</span><span class="op">)</span>, status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, X <span class="op">=</span> <span class="va">X_i</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">i</span>,</span>
<span>                   transition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                   Tstart <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                   Tstop <span class="op">=</span> <span class="va">C</span>,</span>
<span>                   status <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                   X <span class="op">=</span> <span class="va">X_i</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter longitudinal data to observed period</span></span>
<span><span class="va">df_long2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">df_long</span>, <span class="va">df_surv</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"Tstop"</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df_long2</span> <span class="op">&lt;-</span> <span class="va">df_long2</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">df_long2</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'id'</span>, <span class="st">'time'</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">df_long2</span> <span class="op">&lt;-</span> <span class="va">df_long2</span><span class="op">[</span><span class="va">df_long2</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;=</span> <span class="va">df_long2</span><span class="op">$</span><span class="va">Tstop</span>, <span class="op">]</span></span></code></pre></div>
<p>The data for the multi-state process need to be in the appropriate
long format:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_surv</span>, n <span class="op">=</span> <span class="fl">5L</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id transition   Tstart    Tstop status X</span></span>
<span><span class="co">#&gt; 1  1          1 0.000000 1.014016      1 0</span></span>
<span><span class="co">#&gt; 2  1          2 0.000000 1.014016      0 0</span></span>
<span><span class="co">#&gt; 3  1          3 1.014016 1.971082      1 0</span></span>
<span><span class="co">#&gt; 4  2          1 0.000000 7.231688      0 1</span></span>
<span><span class="co">#&gt; 5  2          2 0.000000 7.231688      0 1</span></span></code></pre></div>
<p>for example, subject 1 experienced the following transition:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>→</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">1 \rightarrow 2</annotation></semantics></math>
and therefore is represented in 3 rows, one for each transition, because
all of these transitions were plausible. On the other hand, subject 2 is
only represented by two rows, only for transitions
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>→</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">1 \rightarrow 2</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>→</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">1 \rightarrow 3</annotation></semantics></math>
since these are the only transitions possible from state 1. That is
since subject 2 never actually transitioned to state 2, transition
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>→</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">2 \rightarrow 3</annotation></semantics></math>
was never possible, and therefore, no row for this transition is in the
dataset. It is also important to note that the time in the dataset
follows the counting process formulation with intervals specified by
<code>Tstart</code> and <code>Tstop</code> and that there is a variable
(in this case <code>transition</code>) indicating which transition the
row corresponds to.</p>
</div>
<div class="section level3">
<h3 id="fitting-the-model">Fitting the model<a class="anchor" aria-label="anchor" href="#fitting-the-model"></a>
</h3>
<p>When the data in the appropriate format are available, fitting the
model is very straightforward. First we fit a linear mixed model using
the <code><a href="https://rdrr.io/pkg/nlme/man/lme.html" class="external-link">lme()</a></code> function from package <strong>nlme</strong>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mixedmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/lme.html" class="external-link">lme</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">time</span>, random <span class="op">=</span> <span class="op">~</span> <span class="va">time</span> <span class="op">|</span> <span class="va">id</span>, data <span class="op">=</span> <span class="va">df_long2</span><span class="op">)</span></span></code></pre></div>
<p>Then, we fit a multi-state model using function <code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph()</a></code>
from package <strong>survival</strong> making sure we use the counting
process specification and that we add <code>strata(transition)</code> to
stratify by the transition indicator variable in the dataset.
Furthermore, we add an interaction between covariate <code>X</code> and
each transition to allow the effect of this covariate to vary across
transitions.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">msmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">Tstart</span>, <span class="va">Tstop</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">X</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">transition</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">df_surv</span>, x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Finally, to fit the joint model, we simply run:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jm_ms_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jm.html">jm</a></span><span class="op">(</span><span class="va">msmodel</span>, <span class="va">mixedmodel</span>, time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>                functional_forms <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/jm.html">value</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">transition</span><span class="op">)</span>, </span>
<span>                control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n_iter <span class="op">=</span> <span class="fl">5000L</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">jm_ms_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; jm(Surv_object = msmodel, Mixed_objects = mixedmodel, time_var = "time", </span></span>
<span><span class="co">#&gt;     functional_forms = ~value(y):strata(transition), control = list(n_iter = 5000L))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Data Descriptives:</span></span>
<span><span class="co">#&gt; Number of Groups: 1500       Number of events: 1784 (45.8%)</span></span>
<span><span class="co">#&gt; Number of Observations:</span></span>
<span><span class="co">#&gt;   y: 11573</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                  DIC     WAIC      LPML</span></span>
<span><span class="co">#&gt; marginal    46878.89 46819.94 -23410.00</span></span>
<span><span class="co">#&gt; conditional 49735.76 48815.58 -25551.82</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random-effects covariance matrix:</span></span>
<span><span class="co">#&gt;                     </span></span>
<span><span class="co">#&gt;        StdDev   Corr</span></span>
<span><span class="co">#&gt; (Intr) 1.0559 (Intr)</span></span>
<span><span class="co">#&gt; time   0.5624 0.2185</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Survival Outcome:</span></span>
<span><span class="co">#&gt;                                            Mean  StDev    2.5%  97.5%     P</span></span>
<span><span class="co">#&gt; X:strata(transition)transition=1         0.4802 0.1091  0.2696 0.7001 0.000</span></span>
<span><span class="co">#&gt; X:strata(transition)transition=2        -0.2421 0.1541 -0.5442 0.0593 0.115</span></span>
<span><span class="co">#&gt; X:strata(transition)transition=3         0.6566 0.0821  0.4999 0.8175 0.000</span></span>
<span><span class="co">#&gt; value(y):strata(transition)transition=1  0.5593 0.0227  0.5173 0.6044 0.000</span></span>
<span><span class="co">#&gt; value(y):strata(transition)transition=2  0.3224 0.0422  0.2342 0.4012 0.000</span></span>
<span><span class="co">#&gt; value(y):strata(transition)transition=3  0.2993 0.0185  0.2653 0.3394 0.000</span></span>
<span><span class="co">#&gt;                                           Rhat</span></span>
<span><span class="co">#&gt; X:strata(transition)transition=1        1.0070</span></span>
<span><span class="co">#&gt; X:strata(transition)transition=2        1.0160</span></span>
<span><span class="co">#&gt; X:strata(transition)transition=3        1.0349</span></span>
<span><span class="co">#&gt; value(y):strata(transition)transition=1 1.0534</span></span>
<span><span class="co">#&gt; value(y):strata(transition)transition=2 1.0910</span></span>
<span><span class="co">#&gt; value(y):strata(transition)transition=3 1.2216</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Longitudinal Outcome: y (family = gaussian, link = identity)</span></span>
<span><span class="co">#&gt;                Mean  StDev    2.5%   97.5% P   Rhat</span></span>
<span><span class="co">#&gt; (Intercept)  5.0100 0.0309  4.9507  5.0713 0 0.9998</span></span>
<span><span class="co">#&gt; time        -0.1051 0.0167 -0.1377 -0.0726 0 1.0054</span></span>
<span><span class="co">#&gt; sigma        0.9313 0.0071  0.9174  0.9450 0 1.0004</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; MCMC summary:</span></span>
<span><span class="co">#&gt; chains: 3 </span></span>
<span><span class="co">#&gt; iterations per chain: 5000 </span></span>
<span><span class="co">#&gt; burn-in per chain: 500 </span></span>
<span><span class="co">#&gt; thinning: 1 </span></span>
<span><span class="co">#&gt; time: 4.7 min</span></span></code></pre></div>
<p>which differs from a default call to <code><a href="../reference/jm.html">jm()</a></code> by the
addition of the <code>functional_forms</code> argument specifying that
we want an “interaction” between the marker’s value and each transition,
which translates into a separate association parameter for the
longitudinal marker and each transition.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://www.drizopoulos.com/" class="external-link">Dimitris Rizopoulos</a>, <a href="https://pafonso.com/" class="external-link">Pedro Miranda Afonso</a>, <a href="https://gregpapageorgiou.com/" class="external-link">Grigorios Papageorgiou</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

      </footer>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({


    apiKey: '66a8ef39105517ba1ce2f07aa1c70890',
    indexName: 'drizopoulos',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
