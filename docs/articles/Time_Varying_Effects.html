<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Time Varying Effects • JMbayes2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Time Varying Effects">
<meta name="robots" content="noindex">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-YDBZ5DBBSP"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-YDBZ5DBBSP');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">JMbayes2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6-0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/JMbayes2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Baseline_Hazard.html">Baseline Hazard Function</a></li>
    <li><a class="dropdown-item" href="../articles/Causal_Effects.html">Causal Effects</a></li>
    <li><a class="dropdown-item" href="../articles/Competing_Risks.html">Competing Risks</a></li>
    <li><a class="dropdown-item" href="../articles/Consensus.html">Fitting Joint Models to Big Datasets with Consensus Monte Carlo</a></li>
    <li><a class="dropdown-item" href="../articles/Dynamic_Predictions.html">Dynamic Predictions</a></li>
    <li><a class="dropdown-item" href="../articles/Multi_State_Processes.html">Multi-State Processes</a></li>
    <li><a class="dropdown-item" href="../articles/Non_Gaussian_Mixed_Models.html">Non-Gaussian Mixed Models</a></li>
    <li><a class="dropdown-item" href="../articles/Posterior_Predictive_Checks.html">Posterior Predictive Checks</a></li>
    <li><a class="dropdown-item" href="../articles/Recurring_Events.html">Recurrent Events</a></li>
    <li><a class="dropdown-item" href="../articles/Super_Learning.html">Combined Dynamic Predictions via Super Learning</a></li>
    <li><a class="dropdown-item" href="../articles/Time_Varying_Effects.html">Time Varying Effects</a></li>
    <li><a class="dropdown-item" href="../articles/Transformation_Functions.html">Transformation Functions for Functional Forms</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/drizopoulos/JMbayes2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Time Varying Effects</h1>
                        <h4 data-toc-skip class="author">Dimitris
Rizopoulos</h4>
            
            <h4 data-toc-skip class="date">2026-01-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/drizopoulos/JMbayes2/blob/HEAD/vignettes/Time_Varying_Effects.Rmd" class="external-link"><code>vignettes/Time_Varying_Effects.Rmd</code></a></small>
      <div class="d-none name"><code>Time_Varying_Effects.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="non-proportional-hazards">Non Proportional Hazards<a class="anchor" aria-label="anchor" href="#non-proportional-hazards"></a>
</h2>
<p>The basic definition of the joint model assumes the coefficients that
quantify the association between the versions of the longitudinal
outcomes and the hazard of the event are time-constant (i.e., the
proportional hazards assumption). We can relax this assumption by
specifying time-varying coefficients via the
<code>functional_forms</code> argument of function
<code><a href="../reference/jm.html">jm()</a></code>.</p>
<p>We will illustrate this capability using the PBC dataset. We start by
fitting a Cox model for the composite event transplantation or death,
including sex as a baseline covariate:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbc2.id</span><span class="op">$</span><span class="va">status2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">pbc2.id</span><span class="op">$</span><span class="va">status</span> <span class="op">!=</span> <span class="st">'alive'</span><span class="op">)</span></span>
<span><span class="va">CoxFit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sliced_model_generics.html">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">years</span>, <span class="va">status2</span><span class="op">)</span> <span class="op">~</span> <span class="va">sex</span>, data <span class="op">=</span> <span class="va">pbc2.id</span><span class="op">)</span></span></code></pre></div>
<p>We aim to assess the strength of the association between the risk of
the composite event and the serum bilirubin level. We will describe the
patient-specific profiles over time for this biomarker using a linear
mixed-effects model, where we include an intercept in both the fixed and
random effects, as well as the linear and quadratic time effects. In the
fixed effects, we also include the interaction of the time effect and
sex. The syntax to fit this model with <code><a href="../reference/sliced_model_generics.html">lme()</a></code> is:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sliced_model_generics.html">lme</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">serBilir</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">year</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="va">sex</span>, data <span class="op">=</span> <span class="va">pbc2</span>, </span>
<span>          random <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">year</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">|</span> <span class="va">id</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/lmeControl.html" class="external-link">lmeControl</a></span><span class="op">(</span>opt <span class="op">=</span> <span class="st">'optim'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The default call to <code><a href="../reference/jm.html">jm()</a></code> adds the subject-specific
linear predictor of the mixed model as a time-varying covariate in the
survival relative risk model:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jointFit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jm.html">jm</a></span><span class="op">(</span><span class="va">CoxFit</span>, <span class="va">fm</span>, time_var <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">jointFit1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; JMbayes2::jm(Surv_object = CoxFit, Mixed_objects = fm, time_var = "year")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Data Descriptives:</span></span>
<span><span class="co">#&gt; Number of Groups: 312        Number of events: 169 (54.2%)</span></span>
<span><span class="co">#&gt; Number of Observations:</span></span>
<span><span class="co">#&gt;   log(serBilir): 1945</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                  DIC     WAIC      LPML</span></span>
<span><span class="co">#&gt; marginal    4346.937 6096.897 -3271.149</span></span>
<span><span class="co">#&gt; conditional 8713.787 8448.451 -4517.738</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random-effects covariance matrix:</span></span>
<span><span class="co">#&gt;                               </span></span>
<span><span class="co">#&gt;        StdDev    Corr         </span></span>
<span><span class="co">#&gt; (Intr) 1.3091  (Intr)  p(,2)1 </span></span>
<span><span class="co">#&gt; p(,2)1 21.6892 0.6786         </span></span>
<span><span class="co">#&gt; p(,2)2 12.1450 -0.2361 -0.1267</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Survival Outcome:</span></span>
<span><span class="co">#&gt;                         Mean  StDev    2.5%  97.5%      P   Rhat</span></span>
<span><span class="co">#&gt; sexfemale            -0.1531 0.2625 -0.6448 0.3834 0.5444 1.0118</span></span>
<span><span class="co">#&gt; value(log(serBilir))  1.2974 0.0989  1.1169 1.5105 0.0000 1.0469</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Longitudinal Outcome: log(serBilir) (family = gaussian, link = identity)</span></span>
<span><span class="co">#&gt;                   Mean  StDev     2.5%   97.5%      P   Rhat</span></span>
<span><span class="co">#&gt; (Intercept)     1.4897 0.2236   1.0479  1.9216 0.0000 1.0008</span></span>
<span><span class="co">#&gt; poly(year, 2)1 29.5318 5.1216  19.7020 39.8127 0.0000 1.0106</span></span>
<span><span class="co">#&gt; poly(year, 2)2 -4.8101 3.1672 -11.1911  1.2785 0.1256 1.0055</span></span>
<span><span class="co">#&gt; sexfemale      -0.4703 0.2386  -0.9310  0.0002 0.0502 1.0001</span></span>
<span><span class="co">#&gt; p(,2)1         -5.0308 5.3098 -15.6799  5.3492 0.3393 1.0088</span></span>
<span><span class="co">#&gt; p(,2)2          6.3008 3.2751  -0.1080 12.8040 0.0540 1.0120</span></span>
<span><span class="co">#&gt; sigma           0.3028 0.0061   0.2909  0.3149 0.0000 1.0077</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; MCMC summary:</span></span>
<span><span class="co">#&gt; chains: 3 </span></span>
<span><span class="co">#&gt; iterations per chain: 3500 </span></span>
<span><span class="co">#&gt; burn-in per chain: 500 </span></span>
<span><span class="co">#&gt; thinning: 1 </span></span>
<span><span class="co">#&gt; time: 18 sec</span></span></code></pre></div>
<p>To specify that the association of serum bilirubin may change over
time, we include an interaction of this time-varying covariate with a
natural cubic spline of time using function <code><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns()</a></code> from the
<strong>splines</strong> package. <strong>Important Note:</strong> For
this to work correctly, we need to explicitly specify the internal and
boundary knots for the B-splines basis, i.e., in the following example,
we set the internal knots at 3, 6, and 9 years, and the boundary knots
at 0 and 14.5 years:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">form_splines</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="fu"><a href="../reference/jm.html">value</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">serBilir</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></span><span class="op">(</span><span class="va">year</span>, k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">9</span><span class="op">)</span>, B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">14.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">jointFit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">jointFit1</span>, functional_forms <span class="op">=</span> <span class="va">form_splines</span>, </span>
<span>                    n_iter <span class="op">=</span> <span class="fl">6500L</span>, n_burnin <span class="op">=</span> <span class="fl">2500L</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">jointFit2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; JMbayes2::jm(Surv_object = CoxFit, Mixed_objects = fm, time_var = "year", </span></span>
<span><span class="co">#&gt;     functional_forms = form_splines, n_iter = 6500L, n_burnin = 2500L)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Data Descriptives:</span></span>
<span><span class="co">#&gt; Number of Groups: 312        Number of events: 169 (54.2%)</span></span>
<span><span class="co">#&gt; Number of Observations:</span></span>
<span><span class="co">#&gt;   log(serBilir): 1945</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                  DIC     WAIC      LPML</span></span>
<span><span class="co">#&gt; marginal    4341.405 6355.209 -3701.785</span></span>
<span><span class="co">#&gt; conditional 8721.121 8458.791 -4518.159</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random-effects covariance matrix:</span></span>
<span><span class="co">#&gt;                               </span></span>
<span><span class="co">#&gt;        StdDev    Corr         </span></span>
<span><span class="co">#&gt; (Intr) 1.3165  (Intr)  p(,2)1 </span></span>
<span><span class="co">#&gt; p(,2)1 22.1410 0.6886         </span></span>
<span><span class="co">#&gt; p(,2)2 12.1107 -0.2160 -0.1051</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Survival Outcome:</span></span>
<span><span class="co">#&gt;                                                                   Mean  StDev</span></span>
<span><span class="co">#&gt; sexfemale                                                      -0.1687 0.2778</span></span>
<span><span class="co">#&gt; value(log(serBilir))                                            1.3764 0.2307</span></span>
<span><span class="co">#&gt; value(log(serBilir)):ns(year, k = c(3, 6, 9), B = c(0, 14.5))1 -0.2749 0.2747</span></span>
<span><span class="co">#&gt; value(log(serBilir)):ns(year, k = c(3, 6, 9), B = c(0, 14.5))2 -0.0072 0.3547</span></span>
<span><span class="co">#&gt; value(log(serBilir)):ns(year, k = c(3, 6, 9), B = c(0, 14.5))3 -0.6068 0.7512</span></span>
<span><span class="co">#&gt; value(log(serBilir)):ns(year, k = c(3, 6, 9), B = c(0, 14.5))4 -1.1876 0.9046</span></span>
<span><span class="co">#&gt;                                                                   2.5%  97.5%</span></span>
<span><span class="co">#&gt; sexfemale                                                      -0.7010 0.3837</span></span>
<span><span class="co">#&gt; value(log(serBilir))                                            0.9567 1.8273</span></span>
<span><span class="co">#&gt; value(log(serBilir)):ns(year, k = c(3, 6, 9), B = c(0, 14.5))1 -0.8186 0.2543</span></span>
<span><span class="co">#&gt; value(log(serBilir)):ns(year, k = c(3, 6, 9), B = c(0, 14.5))2 -0.7200 0.7006</span></span>
<span><span class="co">#&gt; value(log(serBilir)):ns(year, k = c(3, 6, 9), B = c(0, 14.5))3 -2.0471 0.9432</span></span>
<span><span class="co">#&gt; value(log(serBilir)):ns(year, k = c(3, 6, 9), B = c(0, 14.5))4 -2.7763 0.6365</span></span>
<span><span class="co">#&gt;                                                                     P   Rhat</span></span>
<span><span class="co">#&gt; sexfemale                                                      0.5503 1.0000</span></span>
<span><span class="co">#&gt; value(log(serBilir))                                           0.0000 1.0511</span></span>
<span><span class="co">#&gt; value(log(serBilir)):ns(year, k = c(3, 6, 9), B = c(0, 14.5))1 0.3257 1.0029</span></span>
<span><span class="co">#&gt; value(log(serBilir)):ns(year, k = c(3, 6, 9), B = c(0, 14.5))2 0.9955 1.0172</span></span>
<span><span class="co">#&gt; value(log(serBilir)):ns(year, k = c(3, 6, 9), B = c(0, 14.5))3 0.4217 1.0656</span></span>
<span><span class="co">#&gt; value(log(serBilir)):ns(year, k = c(3, 6, 9), B = c(0, 14.5))4 0.2075 1.1052</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Longitudinal Outcome: log(serBilir) (family = gaussian, link = identity)</span></span>
<span><span class="co">#&gt;                   Mean  StDev     2.5%   97.5%      P   Rhat</span></span>
<span><span class="co">#&gt; (Intercept)     1.4928 0.2264   1.0449  1.9387 0.0000 1.0071</span></span>
<span><span class="co">#&gt; poly(year, 2)1 30.0902 5.3321  19.8109 40.8594 0.0000 1.0643</span></span>
<span><span class="co">#&gt; poly(year, 2)2 -4.4062 3.2052 -10.5846  1.9815 0.1732 1.0559</span></span>
<span><span class="co">#&gt; sexfemale      -0.4713 0.2410  -0.9480  0.0006 0.0505 1.0053</span></span>
<span><span class="co">#&gt; p(,2)1         -5.3315 5.6721 -16.7089  5.5721 0.3432 1.0534</span></span>
<span><span class="co">#&gt; p(,2)2          6.0298 3.3524  -0.5961 12.6127 0.0733 1.0530</span></span>
<span><span class="co">#&gt; sigma           0.3030 0.0062   0.2907  0.3151 0.0000 1.0019</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; MCMC summary:</span></span>
<span><span class="co">#&gt; chains: 3 </span></span>
<span><span class="co">#&gt; iterations per chain: 6500 </span></span>
<span><span class="co">#&gt; burn-in per chain: 2500 </span></span>
<span><span class="co">#&gt; thinning: 1 </span></span>
<span><span class="co">#&gt; time: 36 sec</span></span></code></pre></div>
<p>The spline coefficients do not have a straightforward interpretation.
We, therefore, visualize the time-varying association of log serum
bilirubin with the hazard of the composite event using the following
piece of code:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.001</span>, <span class="fl">12</span>, length <span class="op">=</span> <span class="fl">501</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></span><span class="op">(</span><span class="va">x_times</span>, knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">9</span><span class="op">)</span>, B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">14.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mcmc_alphas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">'rbind'</span>, <span class="va">jointFit2</span><span class="op">$</span><span class="va">mcmc</span><span class="op">$</span><span class="va">alphas</span><span class="op">)</span></span>
<span><span class="va">log_hr</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">mcmc_alphas</span><span class="op">)</span></span>
<span><span class="va">log_hr_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">log_hr</span><span class="op">)</span></span>
<span><span class="va">log_hr_low</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">log_hr</span>, <span class="fl">1</span>, <span class="va">quantile</span>, probs <span class="op">=</span> <span class="fl">0.025</span><span class="op">)</span></span>
<span><span class="va">log_hr_upp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">log_hr</span>, <span class="fl">1</span>, <span class="va">quantile</span>, probs <span class="op">=</span> <span class="fl">0.975</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">x_times</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">log_hr_mean</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">log_hr_low</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">log_hr_upp</span><span class="op">)</span><span class="op">)</span>, </span>
<span>        type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"black"</span>, <span class="st">"black"</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">"Follow-up Time (years)"</span>, ylab <span class="op">=</span> <span class="st">"Hazard Ratio log serum Bilirubin"</span>,</span>
<span>        ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">6.4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="../reference/methods.html">coef</a></span><span class="op">(</span><span class="va">jointFit1</span><span class="op">)</span><span class="op">$</span><span class="va">association</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">1</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"time-varying coefficient"</span>, <span class="st">"proportional hazards"</span><span class="op">)</span>,</span>
<span>       lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Time_Varying_Effects_files/figure-html/unnamed-chunk-5-1.png" class="r-plt" alt="" width="816" style="display: block; margin: auto;"></p>
<p>We observe that the 95% credible interval for the time-varying
coefficient includes the horizontal line corresponding to proportional
hazards. This is also confirmed by comparing the two models:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/methods.html">compare_jm</a></span><span class="op">(</span><span class="va">jointFit1</span>, <span class="va">jointFit2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                 DIC     WAIC      LPML</span></span>
<span><span class="co">#&gt;  jointFit1 4346.937 6096.897 -3271.149</span></span>
<span><span class="co">#&gt;  jointFit2 4341.405 6355.209 -3701.785</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The criteria are calculated based on the marginal log-likelihood.</span></span></code></pre></div>
<p>The WAIC and LPML indicate that <code>jointFit1</code> is a better
model than <code>jointFit2</code>. The DIC has the same magnitude for
both models.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.drizopoulos.com/" class="external-link">Dimitris Rizopoulos</a>, <a href="https://pafonso.com/" class="external-link">Pedro Miranda-Afonso</a>, <a href="https://gregpapageorgiou.com/" class="external-link">Grigorios Papageorgiou</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
