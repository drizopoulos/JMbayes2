<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Fitting Joint Models to Big Datasets with Consensus Monte Carlo • JMbayes2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fitting Joint Models to Big Datasets with Consensus Monte Carlo">
<meta name="robots" content="noindex">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-YDBZ5DBBSP"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-YDBZ5DBBSP');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">JMbayes2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6-0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/JMbayes2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Baseline_Hazard.html">Baseline Hazard Function</a></li>
    <li><a class="dropdown-item" href="../articles/Causal_Effects.html">Causal Effects</a></li>
    <li><a class="dropdown-item" href="../articles/Competing_Risks.html">Competing Risks</a></li>
    <li><a class="dropdown-item" href="../articles/Consensus.html">Fitting Joint Models to Big Datasets with Consensus Monte Carlo</a></li>
    <li><a class="dropdown-item" href="../articles/Dynamic_Predictions.html">Dynamic Predictions</a></li>
    <li><a class="dropdown-item" href="../articles/Multi_State_Processes.html">Multi-State Processes</a></li>
    <li><a class="dropdown-item" href="../articles/Non_Gaussian_Mixed_Models.html">Non-Gaussian Mixed Models</a></li>
    <li><a class="dropdown-item" href="../articles/Posterior_Predictive_Checks.html">Posterior Predictive Checks</a></li>
    <li><a class="dropdown-item" href="../articles/Recurring_Events.html">Recurrent Events</a></li>
    <li><a class="dropdown-item" href="../articles/Super_Learning.html">Combined Dynamic Predictions via Super Learning</a></li>
    <li><a class="dropdown-item" href="../articles/Time_Varying_Effects.html">Time Varying Effects</a></li>
    <li><a class="dropdown-item" href="../articles/Transformation_Functions.html">Transformation Functions for Functional Forms</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/drizopoulos/JMbayes2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Fitting Joint Models to Big Datasets with Consensus Monte Carlo</h1>
                        <h4 data-toc-skip class="author">Pedro
Miranda-Afonso</h4>
            
            <h4 data-toc-skip class="date">2026-01-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/drizopoulos/JMbayes2/blob/HEAD/vignettes/Consensus.Rmd" class="external-link"><code>vignettes/Consensus.Rmd</code></a></small>
      <div class="d-none name"><code>Consensus.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Applying Bayesian joint models to large datasets, such as patient
registries, can require long computing times that are impractical in
many research settings. This is particularly challenging during the
model-building phase, which often involves fitting and comparing
multiple candidate specifications. In other contexts, the full dataset
cannot be analyzed in a single run due to local memory limitations or
governance constraints (e.g., multi-center collaborations where
individual-level data cannot be shared).</p>
<p>This vignette describes a practical split-and-consensus strategy that
(i) divides the data into independent subject-level subsamples, (ii)
fits the same joint model on each subsample in parallel, and (iii)
combines the resulting MCMC draws into a consensus posterior
distribution that serves as a scalable proxy for the full-data
posterior. In practice, this can substantially reduce wall-clock time
and enables workflows in which model fitting is carried out across
multiple computing nodes or centers.</p>
<p>The resulting consensus distribution is an approximation to the
full-data posterior (i.e., it is not guaranteed to be exact). For this
reason, we recommend using split-and-consensus methods only when fitting
the joint model to the full dataset in a single run is not feasible. A
detailed description of the methodology and practical recommendations
are provided in <a href="https://doi.org/10.48550/arXiv.2310.03351" class="external-link">this
paper</a>.</p>
</div>
<div class="section level2">
<h2 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a>
</h2>
<p>Let <span class="math inline">D = \{(y_i, t_i,
\delta_i)\}_{i=1}^n</span> denote the observed data, where <span class="math inline">y_i</span> represents the longitudinal measurements
for subject <span class="math inline">i</span>, and <span class="math inline">(t_i, \delta_i)</span> denote the event time and
event indicator, respectively. We randomly partition the subjects into
<span class="math inline">S</span> disjoint subsets <span class="math inline">I_1,\ldots,I_S</span>. The corresponding subsamples
are <span class="math inline">D_s = \{(y_i, t_i, \delta_i): i \in
I_s\},</span> <span class="math inline">s = 1,\ldots,S.</span> All
measurements for the same subject are assigned to the same subset.</p>
<p>Under the assumption of conditional independence across the
subsamples given the model parameters <span class="math inline">\theta</span>, the likelihood factorizes across the
subsets: <span class="math display">
p(y, t, \delta \mid \theta, b)=\prod^S_{s=1}p(y^{(s)},
t^{(s)},\delta^{(s)}\mid\theta,b^{(s)}),
</span> where <span class="math inline">y^{(s)} = \{y_i: i \in
I_s\}</span>, <span class="math inline">t^{(s)} = \{t_i: i \in
I_s\}</span>, <span class="math inline">\delta^{(s)} = \{\delta_i: i \in
I_s\}</span>, and <span class="math inline">b^{(s)} = \{b_i: i \in
I_s\}</span>. Using the factorization above, the posterior distribution
can be written as <span class="math display">
p(\theta, b\mid y, t, \delta)\propto p(\theta, b)
\prod^S_{s=1}p(y^{(s)}, t^{(s)}, \delta^{(s)} \mid \theta,
b^{(s)})=\prod^S_{s=1}p_s(\theta, b^{(s)} \mid y^{(s)}, t^{(s)},
\delta^{(s)}).
</span></p>
<p>In pratice, we run independent MCMC on each subsample and then
combine the draws to obtain a consensus approximation, <span class="math inline">\tilde{p}(\theta, b\mid y, t, \delta</span>, which
serves as a proxy for the full posterior.</p>
<p>In <strong>JMbayes2</strong> we provide the following consensus
strategies: - Union: pools (concatenates) the draws from all
subposteriors, treating them as one combined sample. - Equal-weighted
consensus: forms an iteration-wise consensus draw by taking the simple
average across subposterior draws. - Variance/Precision-weighted
consensus: forms an iteration-wise consensus draw using inverse-variance
(precision) weights computed per parameter, so subsamples with lower
posterior variance contribute more to that parameter’s consensus.</p>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>For illustration, we use the <a href="https://www.rdocumentation.org/packages/JMbayes2/versions/0.5-7/topics/pbc2" class="external-link"><code>pbc2</code></a>
and <code>pbc2.id</code> datasets available in
<strong>JMbayes2</strong>. These data are relatively small and can be
analyzed with a standard full-data joint model; therefore, they do not
require split-and-consensus methods. We use them here only to provide a
reproducible example and to demonstrate the workflow.</p>
<p>We present two common use cases:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Speeding posterior sampling</strong> (Example 1) by
splitting the data into subsamples and fitting in parallel on a single
machine.</p></li>
<li><p><strong>Partitioned fitting</strong> (Example 2) when the full
dataset cannot be analyzed in a single run (e.g., multi-center settings
where data cannot be pooled, or single-machine memory limitations). Each
data partition is fitted one-at-a-time, and only the fitted objects are
shared.</p></li>
</ol>
<p>Although we illustrate the approach with a simple joint model (one
longitudinal outcome and one time-to-event outcomes), the same workflow
is available for all models supported by <em>JMbayes2</em>; users only
need to update the model formulation in the code below.</p>
<div class="section level3">
<h3 id="example-1-speeding-posterior-sampling-parallel-fitting">Example 1: Speeding posterior sampling (parallel fitting)<a class="anchor" aria-label="anchor" href="#example-1-speeding-posterior-sampling-parallel-fitting"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Split the dataset into `n_slices` subsamples</span></span>
<span><span class="va">pbc2.id</span><span class="op">$</span><span class="va">status2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">pbc2.id</span><span class="op">$</span><span class="va">status</span> <span class="op">!=</span> <span class="st">'alive'</span><span class="op">)</span> <span class="co"># composite event indicator (1 = death or transplantation, 0 = otherwise)</span></span>
<span><span class="va">data_slc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slicer.html">slicer</a></span><span class="op">(</span>n_slices  <span class="op">=</span> <span class="fl">2</span>, <span class="co"># target number of data subsamples</span></span>
<span>                   id_var    <span class="op">=</span> <span class="st">"id"</span>,  <span class="co"># clustering variable</span></span>
<span>                   data_long <span class="op">=</span> <span class="va">pbc2</span>, <span class="co"># longitudinal dataset</span></span>
<span>                   data_surv <span class="op">=</span> <span class="va">pbc2.id</span>, <span class="co"># survival dataset</span></span>
<span>                   seed      <span class="op">=</span> <span class="fl">123L</span><span class="op">)</span> <span class="co"># seed for reproducibility</span></span>
<span></span>
<span><span class="co"># 2. Specify the number of available cores</span></span>
<span><span class="va">n_cores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fu">parallelly</span><span class="fu">::</span><span class="fu"><a href="https://parallelly.futureverse.org/reference/availableCores.html" class="external-link">availableCores</a></span><span class="op">(</span>omit <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Fit the longitudinal and survival submodels on each subsample</span></span>
<span><span class="co">## 3.1 Fit a linear mixed-effects model </span></span>
<span><span class="va">lme_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sliced_model_generics.html">lme</a></span><span class="op">(</span>data   <span class="op">=</span> <span class="va">data_slc</span><span class="op">$</span><span class="va">long</span>, <span class="co"># list with partitioned longitudinal dataset (class `sliced_data`)</span></span>
<span>               fixed  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">serBilir</span><span class="op">)</span> <span class="op">~</span> <span class="va">year</span> <span class="op">*</span> <span class="va">sex</span>, <span class="co"># fixed-effects formula  </span></span>
<span>               random <span class="op">=</span> <span class="op">~</span> <span class="va">year</span> <span class="op">|</span> <span class="va">id</span>, <span class="co"># random-effects formula describing </span></span>
<span>               cores  <span class="op">=</span> <span class="va">n_cores</span><span class="op">)</span> <span class="co"># number of available cores</span></span>
<span></span>
<span><span class="co">## 3.2 Fit a proportional-hazards model</span></span>
<span><span class="va">ph_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sliced_model_generics.html">coxph</a></span><span class="op">(</span>data    <span class="op">=</span> <span class="va">data_slc</span><span class="op">$</span><span class="va">surv</span>, <span class="co"># list with partitioned survival dataset (class `sliced_data`)</span></span>
<span>                formula <span class="op">=</span> <span class="fu">Surv</span><span class="op">(</span><span class="va">years</span>, <span class="va">status2</span><span class="op">)</span> <span class="op">~</span> <span class="va">sex</span>, <span class="co"># model formula</span></span>
<span>                cores   <span class="op">=</span> <span class="va">n_cores</span><span class="op">)</span> <span class="co"># number of available cores</span></span>
<span></span>
<span><span class="co"># 4. Fit joint model(s) on each subsample</span></span>
<span><span class="va">jm_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jm.html">jm</a></span><span class="op">(</span>Surv_object   <span class="op">=</span> <span class="va">ph_fit</span>, <span class="co"># list with survival submodels (class `sliced_coxph`)</span></span>
<span>             Mixed_objects <span class="op">=</span> <span class="va">lme_fit</span>, <span class="co"># list with longitudinal submodels (class `sliced_lme`)</span></span>
<span>             time_var      <span class="op">=</span> <span class="st">"year"</span>, <span class="co"># time variable in the longitudinal submodel</span></span>
<span>             cores         <span class="op">=</span> <span class="va">n_cores</span><span class="op">)</span> <span class="co"># number of available cores</span></span>
<span></span>
<span><span class="co"># 5. Obtain consensus posterior estimates</span></span>
<span><span class="va">cons_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/consensus.html">consensus</a></span><span class="op">(</span><span class="va">jm_fit</span>, <span class="co"># list with joint models (class `sliced_jm`)</span></span>
<span>                      parm   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alphas"</span>, <span class="st">"betas1"</span><span class="op">)</span>, <span class="co"># parameters of interest</span></span>
<span>                      method <span class="op">=</span> <span class="st">"var_weight"</span>, <span class="co"># consensus algorithm</span></span>
<span>                      seed   <span class="op">=</span> <span class="fl">123L</span><span class="op">)</span> <span class="co"># seed for reproducibility</span></span>
<span><span class="va">cons_fit</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Consensus summary (2 splits)</span></span>
<span><span class="co">#&gt; Method (var_weight): iteration-wise weighted average across splits using inverse-variance weights.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameter block: alphas (9000 draws)</span></span>
<span><span class="co">#&gt;                        Mean  StDev   2.5%  97.5% P   w_S1   w_S2</span></span>
<span><span class="co">#&gt; value(log(serBilir)) 1.2503 0.0885 1.0817 1.4297 0 0.4261 0.5739</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameter block: betas1 (9000 draws)</span></span>
<span><span class="co">#&gt;                   Mean  StDev    2.5%   97.5%      P   w_S1   w_S2</span></span>
<span><span class="co">#&gt; (Intercept)     0.7235 0.1693  0.3870  1.0565 0.0000 0.6853 0.3147</span></span>
<span><span class="co">#&gt; year            0.2648 0.0381  0.1911  0.3407 0.0000 0.5906 0.4094</span></span>
<span><span class="co">#&gt; sexfemale      -0.2410 0.1844 -0.5961  0.1181 0.1880 0.6668 0.3332</span></span>
<span><span class="co">#&gt; year:sexfemale -0.0875 0.0406 -0.1678 -0.0072 0.0329 0.5706 0.4294</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-2-federated-or-sequential-posterior-sampling">Example 2: Federated or sequential posterior sampling<a class="anchor" aria-label="anchor" href="#example-2-federated-or-sequential-posterior-sampling"></a>
</h3>
<p>This example uses a “Center A” and “Center B” framing to mimic a
multi-center setting where individual-level data cannot be shared.
However, the same workflow applies on a single machine when the full
dataset cannot be analyzed all at once (e.g., due to memory constraints
or because the data are stored in separate files that cannot be loaded
simultaneously). In that case, the analyst can fit the model serially on
each subsample, store the fitted objects, and then combine them.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Prepare the data</span></span>
<span><span class="va">pbc2.id</span><span class="op">$</span><span class="va">status2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">pbc2.id</span><span class="op">$</span><span class="va">status</span> <span class="op">!=</span> <span class="st">'alive'</span><span class="op">)</span> <span class="co"># composite event indicator (1 = death or transplantation, 0 = otherwise)</span></span>
<span><span class="va">data_slc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slicer.html">slicer</a></span><span class="op">(</span>n_slices  <span class="op">=</span> <span class="fl">2</span>, <span class="co"># target number of data subsamples</span></span>
<span>                   id_var    <span class="op">=</span> <span class="st">"id"</span>,  <span class="co"># clustering variable</span></span>
<span>                   data_long <span class="op">=</span> <span class="va">pbc2</span>, <span class="co"># longitudinal dataset</span></span>
<span>                   data_surv <span class="op">=</span> <span class="va">pbc2.id</span>, <span class="co"># survival dataset</span></span>
<span>                   seed      <span class="op">=</span> <span class="fl">123L</span><span class="op">)</span> <span class="co"># seed for reproducibility</span></span>
<span><span class="va">data.A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>long <span class="op">=</span> <span class="va">data_slc</span><span class="op">$</span><span class="va">long</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="co"># data from Center A</span></span>
<span>               surv <span class="op">=</span> <span class="va">data_slc</span><span class="op">$</span><span class="va">surv</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> </span>
<span><span class="va">data.B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>long <span class="op">=</span> <span class="va">data_slc</span><span class="op">$</span><span class="va">long</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="co"># data from Center B</span></span>
<span>               surv <span class="op">=</span> <span class="va">data_slc</span><span class="op">$</span><span class="va">surv</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># 2. Fit the longitudinal and survival submodels on each subsample</span></span>
<span><span class="co">## On Center A</span></span>
<span><span class="co">## 2.1.A Fit the linear mixed-effects model </span></span>
<span><span class="va">lme_fit.A</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sliced_model_generics.html">lme</a></span><span class="op">(</span>data   <span class="op">=</span> <span class="va">data.A</span><span class="op">$</span><span class="va">long</span>, <span class="co"># list with partitioned longitudinal dataset (class `sliced_data`)</span></span>
<span>                 fixed  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">serBilir</span><span class="op">)</span> <span class="op">~</span> <span class="va">year</span> <span class="op">*</span> <span class="va">sex</span>, <span class="co"># fixed-effects formula  </span></span>
<span>                 random <span class="op">=</span> <span class="op">~</span> <span class="va">year</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span> <span class="co"># random-effects formula describing </span></span>
<span></span>
<span><span class="co">## 2.2.A Fit the proportional-hazards model</span></span>
<span><span class="va">ph_fit.A</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sliced_model_generics.html">coxph</a></span><span class="op">(</span>data    <span class="op">=</span> <span class="va">data.A</span><span class="op">$</span><span class="va">surv</span>, <span class="co"># list with partitioned survival dataset (class `sliced_data`)</span></span>
<span>                  formula <span class="op">=</span> <span class="fu">Surv</span><span class="op">(</span><span class="va">years</span>, <span class="va">status2</span><span class="op">)</span> <span class="op">~</span> <span class="va">sex</span><span class="op">)</span> <span class="co"># model formula</span></span>
<span></span>
<span><span class="co"># 2.3.A Fit the joint model</span></span>
<span><span class="va">jm_fit.A</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jm.html">jm</a></span><span class="op">(</span>Surv_object   <span class="op">=</span> <span class="va">ph_fit.A</span>, <span class="co"># list with survival submodels (class `sliced_coxph`)</span></span>
<span>               Mixed_objects <span class="op">=</span> <span class="va">lme_fit.A</span>, <span class="co"># list with longitudinal submodels (class `sliced_lme` or `MixMod`)</span></span>
<span>               time_var      <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span> <span class="co"># time variable in the longitudinal submodel</span></span>
<span><span class="va">jm_fit.A</span><span class="op">$</span><span class="va">model_data</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> <span class="co"># remove the datasets</span></span>
<span></span>
<span><span class="co">## On Center B</span></span>
<span><span class="co">## 2.1.B Fit the linear mixed-effects model </span></span>
<span><span class="va">lme_fit.B</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sliced_model_generics.html">lme</a></span><span class="op">(</span>data   <span class="op">=</span> <span class="va">data.B</span><span class="op">$</span><span class="va">long</span>, <span class="co"># longitudinal dataset (class `data.frame`)</span></span>
<span>                 fixed  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">serBilir</span><span class="op">)</span> <span class="op">~</span> <span class="va">year</span> <span class="op">*</span> <span class="va">sex</span>, <span class="co"># fixed-effects formula  </span></span>
<span>                 random <span class="op">=</span> <span class="op">~</span> <span class="va">year</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span> <span class="co"># random-effects formula describing </span></span>
<span></span>
<span><span class="co">## 2.2.B Fit the proportional-hazards model</span></span>
<span><span class="va">ph_fit.B</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sliced_model_generics.html">coxph</a></span><span class="op">(</span>data    <span class="op">=</span> <span class="va">data.B</span><span class="op">$</span><span class="va">surv</span>, <span class="co"># survival dataset (class `data.frame`)</span></span>
<span>                  formula <span class="op">=</span> <span class="fu">Surv</span><span class="op">(</span><span class="va">years</span>, <span class="va">status2</span><span class="op">)</span> <span class="op">~</span> <span class="va">sex</span><span class="op">)</span> <span class="co"># model formula</span></span>
<span></span>
<span><span class="co"># 2.3.B Fit the joint model</span></span>
<span><span class="va">jm_fit.B</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jm.html">jm</a></span><span class="op">(</span>Surv_object   <span class="op">=</span> <span class="va">ph_fit.B</span>, <span class="co"># survival submodels (class `coxph`)</span></span>
<span>               Mixed_objects <span class="op">=</span> <span class="va">lme_fit.B</span>, <span class="co"># longitudinal submodels (class `lme` or `MixMod`)</span></span>
<span>               time_var      <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span> <span class="co"># time variable in the longitudinal submodel</span></span>
<span><span class="va">jm_fit.B</span><span class="op">$</span><span class="va">model_data</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> <span class="co"># remove the datasets</span></span>
<span></span>
<span><span class="co"># 3. Obtain consensus posterior estimates</span></span>
<span><span class="va">fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">jm_fit.A</span>, <span class="va">jm_fit.B</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">fits</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sliced_jm"</span>, <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">fits</span><span class="op">)</span><span class="op">)</span> <span class="co"># consensus() expects the class `sliced_jm`</span></span>
<span></span>
<span><span class="va">cons_fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/consensus.html">consensus</a></span><span class="op">(</span><span class="va">fits</span>, <span class="co"># list with joint models (class `sliced_jm`)</span></span>
<span>                       parm   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alphas"</span>, <span class="st">"betas1"</span><span class="op">)</span>, <span class="co"># parameters of interest</span></span>
<span>                       method <span class="op">=</span> <span class="st">"var_weight"</span>, <span class="co"># consensus algorithm</span></span>
<span>                       seed   <span class="op">=</span> <span class="fl">123L</span><span class="op">)</span> <span class="co"># seed for reproducibility</span></span>
<span><span class="va">cons_fit2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Consensus summary (2 splits)</span></span>
<span><span class="co">#&gt; Method (var_weight): iteration-wise weighted average across splits using inverse-variance weights.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameter block: alphas (9000 draws)</span></span>
<span><span class="co">#&gt;                        Mean  StDev   2.5%  97.5% P   w_S1   w_S2</span></span>
<span><span class="co">#&gt; value(log(serBilir)) 1.2503 0.0885 1.0817 1.4297 0 0.4261 0.5739</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameter block: betas1 (9000 draws)</span></span>
<span><span class="co">#&gt;                   Mean  StDev    2.5%   97.5%      P   w_S1   w_S2</span></span>
<span><span class="co">#&gt; (Intercept)     0.7235 0.1693  0.3870  1.0565 0.0000 0.6853 0.3147</span></span>
<span><span class="co">#&gt; year            0.2648 0.0381  0.1911  0.3407 0.0000 0.5906 0.4094</span></span>
<span><span class="co">#&gt; sexfemale      -0.2410 0.1844 -0.5961  0.1181 0.1880 0.6668 0.3332</span></span>
<span><span class="co">#&gt; year:sexfemale -0.0875 0.0406 -0.1678 -0.0072 0.0329 0.5706 0.4294</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.drizopoulos.com/" class="external-link">Dimitris Rizopoulos</a>, <a href="https://pafonso.com/" class="external-link">Pedro Miranda-Afonso</a>, <a href="https://gregpapageorgiou.com/" class="external-link">Grigorios Papageorgiou</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
